<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="JSONP"><meta name="keywords" content=""><meta name="author" content="Venture,undefined"><meta name="copyright" content="Venture"><title>JSONP | Venture's Blog</title><link rel="shortcut icon" href="/my-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.5.6"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css?version=1.5.6"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#同源策略与跨域"><span class="toc-number">1.</span> <span class="toc-text">同源策略与跨域</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JSON与JSONP"><span class="toc-number">2.</span> <span class="toc-text">JSON与JSONP</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="http://p4hcm0dlf.bkt.clouddn.com/blog/180814/B0i68K4I86.png?imageslim"></div><div class="author-info__name text-center">Venture</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">7</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container" style="background-image: url(true)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Venture's Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">Home</a><a class="site-page" href="/about">About</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span></div><div id="post-info"><div id="post-title">JSONP</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-08-31</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p><em>Before:</em>之前看到了key师傅的一篇博文，关于JSONP的内容，感觉之前遇到过这样的问题，有时间了一起来学习一下</p>
<h2 id="同源策略与跨域"><a href="#同源策略与跨域" class="headerlink" title="同源策略与跨域"></a>同源策略与跨域</h2><p>在学习JSONP之前要先认识同源策略，因为JSONP是基于JSON格式的为解决跨域请求资源而产生的解决方案。</p>
<p>那什么是同源策略？同源策略是一种约定，它是浏览器最核心也最基本的安全功能。所谓同源是指，域名（或IP），协议，端口相同。<strong>浏览器的同源策略，限制了来自不同源的的“document”或脚本，对当前“document”读取和设置某些属性</strong>，可以理解为不同源的脚本不能读写对方的资源。例如，a.com下的js脚本采用ajax读取b.com里面的文件数据是会报错的。同源策略提高了WEB的安全性，但是另一方面来讲，却也是一种限制。随着业务的发展，我们有些场景需要突破上数限制，需要去跨域。解决办法有很多，例如CORS（ajax 可以用CORS来做库跨域请求）、iframe、postMessage等，而属于其中也是比较经典的方法就是JSONP。</p>
<h2 id="JSON与JSONP"><a href="#JSON与JSONP" class="headerlink" title="JSON与JSONP"></a>JSON与JSONP</h2><p>JSON与JSONP是两种不同的东西。JSON一定不会陌生，它是一种JSON是一种基于文本的数据交换方式，或者叫做数据描述格式，脱胎于JavaScript，后台语言几乎全部支持，JSON 的官方 MIME 类型是 <code>application/json</code>。而JSONP是一种非官方跨域数据交互协议。全称为 JSON with Padding。</p>
<p><strong>JSONP实现跨域的原理是因为利用了<code>&lt;script&gt;&lt;/script&gt;</code>标签,可以通过”SRC”属性引用外部js文件。实际上，不只有<script>，带有”src”属性的标签都具有跨域的能力，比如<img>,<iframe>,<link>。</strong>这应该算是针对同源策略开的后门吧2333。</p>
<p>JSONP过程大致是这样的：请求方利用<script>标签，属性src指向响应方，其中查询参数通常为callback，而值为前端定义好的函数名称，响应方根据得到的callback的值，会将json数据放在以这个值为函数名的回调函数里做为参数传回请求方，请求方得到数据后按照自己需求进行处理和展现。</p>
<p>例如返回的数据：jsonp({ “state”: “success” , “msg”: “获取成功” });  jsonp 就是自定义的函数名，所以JSONP=JSON+Padding</p>
<p>具体的代码就不举例了</p>
<h2 id="JSON劫持"><a href="#JSON劫持" class="headerlink" title="JSON劫持"></a>JSON劫持</h2><p>JSON 劫持又为“ JSON Hijacking ，这个问题属于读取型CSRF攻击范畴，是由于没有经过限制，在传递敏感数据时，攻击者可以构造恶意页面截取敏感数据。</p>
<p>POC</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">＜script＞ </div><div class="line">function jsonp1(json)&#123; </div><div class="line">alert(JSON.stringify(json)) </div><div class="line">  &#125; </div><div class="line">＜/script＞  </div><div class="line"></div><div class="line">＜script src=&quot;https://www.a.com/getuserinfo.php?callback=jsonp1&quot;＞＜/script＞</div></pre></td></tr></table></figure>
<p>简单的判断还可以就直接换到另一个浏览器打开，看是否正常显示，如果存在，基本可以确定存在JSONP</p>
<p>常见参数名：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">callback=</div><div class="line">cb=</div><div class="line">jsonp=</div><div class="line">jsonpcallback=</div><div class="line">json=</div><div class="line">jsoncallback=</div><div class="line">jcb=</div><div class="line">call=</div></pre></td></tr></table></figure>
<h3 id="绕过referer"><a href="#绕过referer" class="headerlink" title="绕过referer"></a>绕过referer</h3><p>具体可以看看KEY师傅的referer绕过:<a href="http://gh0st.cn/archives/2018-08-01/1">http://gh0st.cn/archives/2018-08-01/1</a></p>
<h3 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h3><p>在查询url中还可能出现XSS ，例如<code>http://www.a.com/getUserinfo.php?callback=&lt;script&gt;alert(/xss/)&lt;/script&gt;</code></p>
<p>是由于没有没有严格定义好 Content-Type（ Content-Type: application/json ）再加上没有进行过滤直接导致的</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="http://blog.knownsec.com/2015/03/jsonp_security_technic/">http://blog.knownsec.com/2015/03/jsonp_security_technic/</a></p>
<p><a href="http://gh0st.cn/archives/2018-03-22/1">http://gh0st.cn/archives/2018-03-22/1</a></p>
<p><a href="http://www.cnblogs.com/dowinning/archive/2012/04/19/json-jsonp-jQuery.html">http://www.cnblogs.com/dowinning/archive/2012/04/19/json-jsonp-jQuery.html</a></p>
<p><a href="http://www.cnblogs.com/vimsk/archive/2013/01/29/2877888.html">http://www.cnblogs.com/vimsk/archive/2013/01/29/2877888.html</a></p>
<p><a href="https://zh.wikipedia.org/wiki/JSONP">https://zh.wikipedia.org/wiki/JSONP</a></p>
<p><a href="https://segmentfault.com/a/1190000009577990">https://segmentfault.com/a/1190000009577990</a></p>
<p><a href="https://segmentfault.com/a/1190000009624849#articleHeader0">https://segmentfault.com/a/1190000009624849#articleHeader0</a></p>
<p><a href="https://www.cnblogs.com/rockmadman/p/6836834.html">https://www.cnblogs.com/rockmadman/p/6836834.html</a></p>
</script></strong></p></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Venture</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://yoursite.com/2018/08/31/jsonp/">http://yoursite.com/2018/08/31/jsonp/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://yoursite.com" target="_blank">Venture's Blog</a>！</span></div></div><div class="post-meta__tag-list"></div><nav id="pagination"><div class="next-post pull-right"><a href="/2018/08/30/RSA/"><span>RSA之共模攻击</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2017 - 2018 By Venture</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">Hi, welcome to my <a href="https://ventureyu.github.io">blog</a>!</div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="/js/third-party/anime.min.js"></script><script src="/js/third-party/jquery.min.js"></script><script src="/js/third-party/jquery.fancybox.min.js"></script><script src="/js/third-party/velocity.min.js"></script><script src="/js/third-party/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.5.6"></script><script src="/js/fancybox.js?version=1.5.6"></script><script src="/js/sidebar.js?version=1.5.6"></script><script src="/js/copy.js?version=1.5.6"></script><script src="/js/fireworks.js?version=1.5.6"></script><script src="/js/transition.js?version=1.5.6"></script><script src="/js/scroll.js?version=1.5.6"></script><script src="/js/head.js?version=1.5.6"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.jsdelivr.net/npm/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>